

#include <gb/gb.h>
#include <string.h>

#define TileWidth		20 // in 8x8 tiles
#define TileHeight		18 

unsigned char col_tile_dat[] =
{
  0xFF,0xFF,0xFF,0xFF,0xC3,0xFF,0xDB,0xE7,
  0xDB,0xE7,0xC3,0xFF,0xFF,0xFF,0xFF,0xFF,
  0x00,0x00,0x00,0x00,0x60,0x00,0x18,0x00,
  0x0C,0x00,0x70,0x00,0x10,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

unsigned char col_map[] =
{
  0x02,0x02,0x02,0x03,0x03,0x03,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x02,0x00,0x00,
  0x02,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x00,0x00,
  0x02,0x03,0x00,0x00,0x03,0x03,0x03,0x03,0x03,0x03,
  0x03,0x00,0x00,0x00,0x03,0x03,0x02,0x03,0x03,0x03,
  0x02,0x03,0x00,0x00,0x03,0x01,0x03,0x03,0x03,0x03,
  0x01,0x00,0x00,0x00,0x02,0x03,0x03,0x03,0x03,0x03,
  0x02,0x02,0x03,0x03,0x01,0x02,0x03,0x03,0x03,0x03,
  0x01,0x00,0x00,0x00,0x03,0x03,0x03,0x03,0x03,0x03,
  0x02,0x03,0x03,0x03,0x02,0x03,0x03,0x03,0x02,0x03,
  0x02,0x00,0x00,0x00,0x03,0x03,0x03,0x03,0x00,0x00,
  0x03,0x02,0x03,0x03,0x03,0x02,0x03,0x02,0x03,0x03,
  0x02,0x02,0x03,0x01,0x02,0x03,0x03,0x03,0x00,0x00,
  0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x03,0x02,
  0x03,0x02,0x03,0x03,0x01,0x01,0x02,0x03,0x00,0x00,
  0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x02,0x03,
  0x03,0x03,0x03,0x03,0x03,0x01,0x03,0x03,0x00,0x00,
  0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x01,0x03,
  0x03,0x03,0x02,0x03,0x03,0x03,0x03,0x03,0x00,0x00,
  0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x02,0x03,
  0x03,0x03,0x03,0x03,0x00,0x00,0x03,0x03,0x00,0x00,
  0x03,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x03,0x03,
  0x02,0x02,0x02,0x01,0x00,0x00,0x01,0x02,0x00,0x00,
  0x03,0x03,0x01,0x01,0x03,0x00,0x00,0x00,0x03,0x03,
  0x03,0x03,0x02,0x01,0x02,0x03,0x01,0x03,0x00,0x00,
  0x03,0x03,0x03,0x01,0x03,0x00,0x00,0x00,0x03,0x03,
  0x02,0x02,0x01,0x03,0x03,0x03,0x01,0x03,0x00,0x00,
  0x03,0x03,0x03,0x02,0x01,0x00,0x00,0x00,0x03,0x03,
  0x02,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,
  0x03,0x03,0x03,0x03,0x02,0x01,0x03,0x03,0x03,0x01,
  0x01,0x01,0x01,0x01,0x01,0x02,0x03,0x03,0x00,0x00,
  0x00,0x00,0x03,0x03,0x03,0x02,0x03,0x02,0x03,0x02,
  0x02,0x02,0x03,0x02,0x03,0x03,0x00,0x00,0x00,0x00,
  0x00,0x00,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x02,
  0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00
};

unsigned char player[] =
{
  0x3C,0x3C,0x42,0x7E,0x81,0xFF,0xA5,0xFF,
  0x81,0xFF,0xBD,0xFF,0x56,0x7E,0x3C,0x3C,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

UINT16 playerxy[2]; // ok. Interesting.

void init() {
	DISPLAY_ON;
	set_bkg_data(0, 2, col_tile_dat);
	set_bkg_tiles(0, 0, 20, 18, col_map);
	set_sprite_data(0, 2, player);
	set_sprite_tile(0, 0);
	playerxy[0] = 80;
	playerxy[1] = 72;
}

void checkInputL() { 
	if ((joypad() & J_LEFT) && (col_map[(((playerxy[1] - 9) / 8) * 20) + ((playerxy[0] - 9) / 8)] != 0x00) \
				  && (col_map[(((playerxy[1] - 16) / 8) * 20) + ((playerxy[0] - 9) / 8)] != 0x00)) { // 8 - 1
		if (playerxy[0] - 1 != 7) {
			playerxy[0]--;
		} 
		
	}
}

void checkInputR() {
	if ((joypad() & J_RIGHT) && (col_map[(((playerxy[1] - 9) / 8) * 20) + ((playerxy[0]) / 8)] != 0x00) \
			  && (col_map[(((playerxy[1] - 16) / 8) * 20) + ((playerxy[0]) / 8)] != 0x00) ) { // 1 - 1 = 0
		if (playerxy[0] + 1 != 161) {
			playerxy[0]++;
		} 
		
	} 
}

void checkInputU() {
	if ((joypad() & J_UP) && (col_map[(((playerxy[1] - 17) / 8) * 20) + ((playerxy[0] - 8) / 8)] != 0x00) \
	                    && (col_map[(((playerxy[1] - 17) / 8) * 20) + ((playerxy[0] - 1) / 8)] != 0x00)  ) {
		if (playerxy[1] - 1 != 15) {
			playerxy[1]--;
		}
		
	}
}

void checkInputD() {
	if ((joypad() & J_DOWN) && ((col_map[(((playerxy[1] - 8) / 8) * 20) + ((playerxy[0] - 1) / 8)] != 0x00) \
						   && (col_map[(((playerxy[1] - 8) / 8) * 20) + ((playerxy[0] - 8) / 8)] != 0x00))) {
		if (playerxy[1] + 1 != 153) {
			playerxy[1]++;	
		}
		
	}
}

void main() {
	init();

	HIDE_WIN;
	SHOW_BKG;
	SHOW_SPRITES;

	while (1) {
		checkInputL();
		checkInputR();
		checkInputU();
		checkInputD();
		move_sprite(0, playerxy[0], playerxy[1]);
		wait_vbl_done();
	}

}